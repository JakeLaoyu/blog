!function(){const e=e=>(e=encodeURI(e),document.getElementById(e).querySelector(".leancloud-visitors-count")),{app_id:t,app_key:o,server_url:n}=CONFIG.leancloud_visitors,r=n=>{var r=(e,r,s)=>fetch(n+"/1.1"+r,{method:e,headers:{"X-LC-Id":t,"X-LC-Key":o,"Content-Type":"application/json"},body:JSON.stringify(s)});if(CONFIG.page.isPost){if(CONFIG.hostname===location.hostname){var s=r,l=document.querySelector(".leancloud_visitors");const t=decodeURI(l.id),o=l.dataset.flagTitle;s("get","/classes/Counter?where="+encodeURIComponent(JSON.stringify({url:t}))).then((e=>e.json())).then((({results:n})=>{0<n.length?(n=n[0],e(t).innerText=n.time+1,s("put","/classes/Counter/"+n.objectId,{time:{__op:"Increment",amount:1}}).catch((e=>{console.error("Failed to save visitor count",e)}))):CONFIG.leancloud_visitors.security?(e(t).innerText="Counter not initialized! More info at console err msg.",console.error("ATTENTION! LeanCloud counter has security bug, see how to solve it here: https://github.com/theme-next/hexo-leancloud-counter-security. \n However, you can still use LeanCloud without security, by setting `security` option to `false`.")):s("post","/classes/Counter",{title:o,url:t,time:1}).then((e=>e.json())).then((()=>{e(t).innerText=1})).catch((e=>{console.error("Failed to create",e)}))})).catch((e=>{console.error("LeanCloud Counter Error",e)}))}}else if(1<=document.querySelectorAll(".post-title-link").length){l=r;const t=[...document.querySelectorAll(".leancloud_visitors")].map((e=>decodeURI(e.id)));return void l("get","/classes/Counter?where="+encodeURIComponent(JSON.stringify({url:{$in:t}}))).then((e=>e.json())).then((({results:o})=>{for(const r of t){var n=o.find((e=>e.url===r));e(r).innerText=n?n.time:0}})).catch((e=>{console.error("LeanCloud Counter Error",e)}))}};let s;n?s=n:"-MdYXbMMI"===t.slice(-9)&&(s=`https://${t.slice(0,8).toLowerCase()}.api.lncldglobal.com`),document.addEventListener("page:loaded",(()=>{s?r(s):fetch("https://app-router.leancloud.cn/2/route?appId="+t).then((e=>e.json())).then((({api_server:e})=>{r("https://"+e)}))}))}();